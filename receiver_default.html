<html>
<head>
  <title>Chromecast Sample Default Receiver</title>
  <script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
</head>

<body style='overflow: hidden'>
  <div id="splash_screen" style="width: 100%; height: 100%; background-color: black;">
      <img id="splash_image" style="display: block; width: 50%; margin: auto; position: absolute; top: 0; left: 0; bottom: 0; right: 0; vertical-align: middle" />
  </div>
  <div id='player'></div>
  <script>
    // Locations of the images that will show on receiver screens. You are welcomed to configure these image locations.
    var SPLASH_SCREEN_SRC = "./images/ooyala-logo.png";
    var LOGO_IMAGE_SRC = "./images/ooyala-logo.png";
    var PAUSE_ICON_SRC = " ./images/pause.png";
    var WATERMARK_ICON_SRC = "./images/ooyala-logo-watermark.png";
   
    window.onload = function() {
      var V3_URL = "//player.ooyala.com/v3/51a0285082d44e37b5d3fbf2b4a9812b?debug=true&version=4f18e79abadaf7829a23bee44ea08cb8e3948636";

      var splashImage = document.querySelector("#splash_image");
      splashImage.src = SPLASH_SCREEN_SRC;
        
      var playerJs = document.createElement("script");
      playerJs.type = "text/javascript";
      playerJs.src = V3_URL;

      playerJs.onload = (function() {
        window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
        window.castMB = window.castReceiverManager.getCastMessageBus("urn:x-cast:com.google.cast.media");
        // onMessage gets called every time the sender sends a message
        // It receives messages through google's message bus and will then
        // publish events to ooyala core player message bus
        window.castMB.onMessage = function(evt) {
          // Adds error handling to the received messages
          var message = null;
            var ERROR_MESSAGE = "Exception in message format";
            console.log(JSON.stringify(evt, null, '\t'));

          if (evt && evt.data) {
            message = JSON.parse(evt.data);
            if (!message.type) {
              console.error(ERROR_MESSAGE);
              return;
            }
            if (message.type == "GET_STATUS") {
              // very first incoming message upon creation of message bus is GET_STATUS,
              // it should be ignored here
              return;
            }
            if (!message.media || !message.media.customData) {
              // message to load media is the second incoming message after GET_STATUS (see above)
              // this will be the only one mesasage going through this channel, all subsequest messages
              // will be going through player's CastReceiverModule
              console.error(ERROR_MESSAGE);
            }
          }

          var data = message.media.customData;
          var playerParams = {};
          if (data.params) {
            if (typeof data.params === "string") {
              playerParams = eval("(" + data.params + ")");
            } else if (typeof data.params === "object") {
              playerParams = data.params;
            }
          }
          if (typeof playerParams['autoplay'] !== 'boolean') {
            playerParams['autoplay'] = true;
          }
          playerParams['splashScreen'] = SPLASH_SCREEN_SRC;
          playerParams['logoImage'] = LOGO_IMAGE_SRC;
          playerParams['pauseIcon'] = PAUSE_ICON_SRC;
          playerParams['watermarkIcon'] = WATERMARK_ICON_SRC;
          var player = OO.Player.create('player', data.ec, playerParams);
          player.mb.publish(OO.EVENTS.CHROMECAST_INIT, data);
        }
      });
      document.head.appendChild(playerJs);
    }
  </script>
</body>
</html>